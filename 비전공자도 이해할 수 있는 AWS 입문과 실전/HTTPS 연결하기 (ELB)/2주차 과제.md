# HTTP 와 HTTPS 의 비교

## HTTP 프로토콜 작동 방식
HTTP(Hypertext Transfer Protocol)는 WorldWide Web에서 데이터가 통신하기 위한 프로토콜로,
OSI(Open Systems Interconnection) 모델에서 애플리케이션 계층의 프로토콜입니다.
사이트에 `http(s)://`naver.com 과 같이 앞에 http 가 많이 붙어있는 걸 보셨을텐데, 이는 이 웹사이트가 http 프로토콜을 따르고 있다는 걸 주소에 명시함으로써
서버가 http 형식으로 해당 페이지를 읽은 뒤 그에 맞는 응답으로 작성하고 해독해 웹페이지를 보여주게 됩니다.
80번 포트를 사용하여 브라우저가 서버와 통신하여 데이터를 주고받는 방법을 정의합니다.
HTTP 서버가 80번 포트에서 요청을 기다리고, 클라이언트는 80번 포트로 요청을 보내게 됩니다.
다만, HTTP는 암호화되지 않은 데이터로 주고받기 때문에, 누군가 데이터를 가로채고 읽을 수 있다는 단점이 있습니다.

## HTTPS 프로토콜 작동 방식
HTTP와 HTTPS 프로토콜의 유일한 차이점은 HTTPS는 TLS(SSL)를 사용하여 일반 HTTP 요청과 응답을 암호화하고 해당 요청과 응답에 디지털 서명을 한다는 점입니다.
따라서 내가 어떤 사이트에 보내는 정보가 암호화되어 나가기에 읽지 못하게 할 뿐더러, 접속한 사이트가 신뢰할 만 한 사이트인 판별할 수 있게 합니다.
기관으로부터 검증된 사이트만 HTTPS 사용을 허가하기 때문입니다.

HTTPS 는 비대칭키 방식을 사용합니다. 대칭키에서는 어떤 키로 암호화하면 같은 키로 복호화할 수 있었지만,
비대칭키에서는 한 쌍인 두 개의 키를 사용해, (두 개의 키를 각각 A키, B키라고 하였을 때) A키로 암호화한 암호문은 B키로만 복호화가 가능하고 B키로 암호화한 암호문은 A키로만 복호화가 가능합니다.
서버는 이 두 키 중 하나인 개인키는 비밀로 보관하고 나머지는 누구나 볼 수 있도록 공개키로 공개합니다. 
따라서 사용자는 공개키로 암호화해 데이터를 서버에 보내고, 개인키를 갖고있는 서버만 이를 복호화해 볼 수 있습니다.
이때 이 서버에서 우리에게 보내는 정보는 서버의 개인키로 암호화 되어있기에 우리가 공개된 공개키로 풀어 볼 수 있는 정보는 이 서버의 개인키로 암호화된 정보 뿐이기에
이 사이트가  신뢰할 만 한 사이트인지를 판별 가능하게 됩니다.

그러려면 이 공개키가 우회사이트가 아닌, 내가 접속하려는 서버의 것이 맞는지를 확인 할 수 있어야 합니다.
이를 인증해주는 공인된 민간기업들인 CA 있습니다. 우리의 웹 브라우저에는 이 CA들의 목록이 내장되어 있습니다.

클라이언트는 아직 서버를 신뢰하지 못하기에, handshake 를 통해 탐색과정을 거칩니다.
먼저 클라이언트가 랜덤 데이터를 생성해 서버에 보낸 뒤, 서버는 답변으로 서버측에서 생성된 랜덤 데이터와 서버의증 SSL/TLS 인증서를 함께 보내줍니다.
이제 클라이언트가 이 SSL/TLS 인증서가 진짜인지 브라우저에 내장된 CA를 통해 비대칭키 방식으로 인증과정을 거칩니다.
CA의 인증을 받은 SSL/TLS 인증서들은 CA의 개인키로 암호화되어 있기에 진짜라면 CA의 공개키로 복호화 가능합니다.
따라서 이 과정을 통해 해당 사이트가 CA에 공인된 사이트인지 확인할 수 있습니다.

그렇게 성공적으로 복호화된 SSL/TLS 인증서에는 이 서버의 공개키가 포함되어 있습니다.
다만 비대칭키 방식으로 메세지를 암호화/복호화하면 대칭키보다 컴퓨터에 훨씬 큰 부담을 주기 때문에
사이트를 이용할 때 주고받을 다량의 데이터를 비대칭키로 일일이 암호화, 복호화하면 무리가 갑니다.

따라서 이 데이터는 대칭키로 암호화합니다. 다만 탈취의 우려가 있으니, 대칭키를 공유할 때 비대칭키를 사용하게 됩니다.
클라이언트가 handshake 할 때 생성된 랜덤 데이터 둘 (클라이언트 생성, 서버 생성) 을 혼합해 임시키를 생성합니다.
그리고 이 임시키를 서버의 공개키로 암호화 해 서버로 보낸 다음, 이 임시키를 대칭키로 사용해 사이트를 사용하게 됩니다.

> SSL은 90년대 중반 넷스케이프에 의해 생성된 오리지날 프로토콜이지만 현재는 폐기되고 TLS가 IETF에서 유지, 관리하는 웹의 보안 암호화를 위해 나온 새로운 프로토콜입니다.
> 히스토리가 궁금하시면 https://howhttps.works/ko/https-ssl-tls-differences/ 해당 웹사이트를 참조하시면 좋을 것 같습니다.

## HTTP/1 vs HTTP/2 vs HTTP/3, HTTPS의 차이점

### HTTP/1.x
HTTP/1.1 요청 작동 방식을 살펴보겠습니다.
1. 웹사이트로 이동하기 위해 브라우저에 GET 서버에 요청을 보냅니다.

```
GET al1kite.github.io
```

2. 서버는 문서와 함께 요청과 응답을 받습니다.

```
200 OK

<html>
  <head>
    <title>Accreditly - Web Development Certifications</title>
```
브라우저는 문서를 읽고, 1단계와 단계를 반복하며 요청과 응답을 실행합니다.
쉬운 흐름이지만 해당 방식에는 몇 가지 문제가 존재했습니다.

1. HOL 블로킹 (Head-of-line blocking) : 한 번에 하나의 요청만 처리할 수 있기에,
   후속 요청은 이전 요청이 완료될 때까지 기다려야 했기 때문에 네트워크 리소스가 비효율적으로 사용되는 경우가 많았습니다.
2. 우선순위 부족: 비슷한 이야기로, 요청의 우선순위를 지정하는 방법을 제공하지 않았으므로 덜 중요한 리소스가 더 중요한 리소스를 차단할 수 있었습니다.
3. 쿠키가 사용 중일 때 대용량 일반 텍스트 헤더가 전송되는 리소스 문제도 있었습니다.

다음과 같은 문제들로 웹의 성능에 큰 영향을 미쳤습니다.

### HTTP/2.x
따라서 다음과 같은 문제를 해결하기 위한 목적으로 HTTP/2.x 가 나왔습니다. 

1. 멀티플렉싱: HTTP/2는 멀티플렉싱을 사용해 자산을 함께 요청한 다음 동일한 연결에서 동일한 방식으로 이를 수신하는 방식을 채택했습니다.
2. 헤더 압축: HPACK 알고리즘을 사용하여 요청 및 응답 헤더를 압축하여 전송되는 데이터 양을 크게 줄였습니다.
3. 스트림 우선순위 지정: 클라이언트가 요청의 우선순위를 지정하여 보다 중요한 리소스를 먼저 가져와서 렌더링할 수 있게 했습니다.
4. 서버 푸쉬: 리소스가 요청되기 전, 클라이언트의 캐시에 리소스를 푸시하여 대기 시간을 줄입니다.
5. 바이너리 프레임화: 바이너리를 프레임화 하는 계층을 사용하여 메시지를 캡슐화하므로 HTTP/1.x의 일반 텍스트 접근 방식에 비해 프로토콜이 더 효율적이고 오류가 덜 발생합니다.

HTTP/2는 작동하기 위해 동일한 기본 프로토콜인 TCP를 사용합니다. 
이미 HTTP/1.x 에서 채택한 방식이기에 새로운 기본 프로토콜을 구현할 필요가 없으며 몇 가지 조정만 하면 된다는 장점이 있었지만, 
대기 시간이 길고 손실이 많은 네트워크에서 특히 TCP에 이슈가 있었습니다.

### HTTP/3.x
HTTP/3은 TCP를 없애고 대신 Quick UDP Internet Connections 또는 'QUIC'라고 불리는 UDP의 특징을 활용합니다.

QUIC에는 몇 가지 이점이 있습니다.

1. 내장된 암호화: QUIC는 기본적으로 TLS(Transport Layer Security) 1.3을 통합하여 별도의 TLS handshake 없이도 안전한 연결을 보장합니다. 따라서 대기 시간이 줄어들고 연결 설정 시간이 향상됩니다.
2. HOL 블로킹 감소: TCP와 달리 QUIC는 개별 스트림 수준에서 패킷 손실을 처리합니다. 즉, 단일 패킷의 손실로 인해 전체 연결이 차단되지 않으므로 HOL 블로킹 문제가 더욱 줄어듭니다.
3. 연결 마이그레이션: QUIC는 연결 마이그레이션을 더 잘 지원하도록 설계되어 클라이언트가 연결이 끊어지거나 추가 대기 시간이 발생하지 않고 IP 주소를 변경할 수 있습니다. 특히 모바일/셀룰러 연결 사용자가 이점을 누릴 수 있는 것입니다.
4. 0-RTT 연결 설정: QUIC은 특정 상황에서 0-RTT(왕복 시간 0) 연결 설정을 활성화하여 이전에 방문한 서버에 연결할 때 대기 시간을 크게 줄일 수 있습니다.
5. 향상된 혼잡 제어: QUIC는 더욱 발전된 혼잡 제어 메커니즘을 제공하여 다양한 네트워크 조건에 더 잘 적응하고 전반적인 성능을 향상시킬 수 있습니다

이론상으로는 QUIC 가 좋지만, 문제는 네트워크 인프라와의 호환성 문제는 말할 것도 없고 브라우저와 제공업체가 이러한 기능을 구현해야 하는 큰 과제가 존재합니다.
많은 대규모 네트워크는 UDP를 지원하지 않으므로 UDP 위에 위치하는 새로운 프로토콜에서 트래픽을 파이핑하는 것에는 한계가 있습니다.
하지만 HTTP/3은 실제로 2022년 7월 이후 출시된 표준으로, 남북 웹 트래픽의 약 70% 이상이 HTTP/3으로 전환 과정에 있습니다.

HTTP/3 자체는 속도와 보안 개선을 이해하고 희망적으로는 새로운 프로토콜을 의미합니다.


